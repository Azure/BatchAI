{
  "title": "Job's schema validation.",
  "type": "object",
  "properties": {
    "properties": {
      "type": "object",
      "description": "Defines job parameters. Please choose one of cntkSettings, tensorFlowSettings, caffeSettings, caffe2Settings, chainerSettings or customToolkitSettings toolkit settings.",
      "properties": {
        "experimentName": {
          "type": "string",
          "description": "Describe the experiment information of the job."
        },
        "priority": {
          "type": "integer",
          "default": "0",
          "description": "Priority associated with the job. Priority values can range from -1000 to 1000, with -1000 being the lowest priority and 1000 being the highest priority. The default value is 0."
        },
        "location": {
          "type": "string",
          "description": "Job's location. Usually you would like to define it via Azure CLI command line parameters."
        },
        "cluster": {
          "$ref": "#/definitions/ResourceId",
          "description": "Cluster resource Id. Usually you would like to define if via Azure CLI command line parameters"
        },
        "nodeCount": {
          "type": "integer",
          "description": "The job will be gang scheduled on that many compute nodes"
        },
        "containerSettings": {
          "$ref": "#/definitions/ContainerSettings",
          "description": "If not provided, the job will run on the VM."
        },
        "jobPreparation": {
          "$ref": "#/definitions/JobPreparation",
          "description": "The specified actions will run on all the nodes that are part of the job"
        },
        "stdOutErrPathPrefix": {
          "type": "string",
          "description": "The path where the Batch AI service will upload stdout and stderror of the job."
        },
        "inputDirectories": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/InputDirectory"
          }
        },
        "outputDirectories": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/OutputDirectory"
          }
        },
        "environmentVariables": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/EnvironmentSetting"
          },
          "description": "Batch AI service sets the following environment variables for all jobs: AZ_BATCHAI_INPUT_id, AZ_BATCHAI_OUTPUT_id, AZ_BATCHAI_NUM_GPUS_PER_NODE. For distributed TensorFlow jobs, following additional environment variables are set by the Batch AI Service: AZ_BATCHAI_PS_HOSTS, AZ_BATCHAI_WORKER_HOSTS"
        },
        "constraints": {
          "$ref": "#/definitions/JobBaseProperties_constraints",
          "description": "Constraints associated with the Job."
        },
        "cntkSettings": {
          "$ref": "#/definitions/CNTKsettings"
        },
        "tensorFlowSettings": {
          "$ref": "#/definitions/TensorFlowSettings"
        },
        "caffeSettings": {
          "$ref": "#/definitions/CaffeSettings"
        },
        "caffe2Settings": {
          "$ref": "#/definitions/Caffe2Settings"
        },
        "chainerSettings": {
          "$ref": "#/definitions/ChainerSettings"
        },
        "customToolkitSettings": {
          "$ref": "#/definitions/CustomToolkitSettings"
        }
      },
      "required": ["nodeCount"],
      "additionalProperties": false
    }
  },
  "definitions": {
    "AutoScaleSettings": {
      "type": "object",
      "properties": {
        "minimumNodeCount": {
          "oneOf": [
            {
              "type": "integer"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        },
        "maximumNodeCount": {
          "oneOf": [
            {
              "type": "integer"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        },
        "initialNodeCount": {
          "oneOf": [
            {
              "type": "integer",
              "default": "0"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        }
      },
      "required": [
        "minimumNodeCount",
        "maximumNodeCount"
      ],
      "description": "The system automatically scales the cluster up and down (within minimumNodeCount and maximumNodeCount) based on the pending and running jobs on the cluster."
    },
    "AzureBlobFileSystemReference": {
      "type": "object",
      "properties": {
        "accountName": {
          "type": "string"
        },
        "containerName": {
          "type": "string"
        },
        "credentials": {
          "oneOf": [
            {
              "$ref": "#/definitions/AzureStorageCredentialsInfo"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        },
        "relativeMountPath": {
          "type": "string",
          "description": "Note that all blob file systems will be mounted under $AZ_BATCHAI_MOUNT_ROOT location."
        },
        "mountOptions": {
          "type": "string"
        }
      },
      "required": [
        "accountName",
        "containerName",
        "credentials",
        "relativeMountPath"
      ],
      "description": "Provides required information, for the service to be able to mount Azure Blob Storage container on the cluster nodes."
    },
    "AzureFileShareReference": {
      "type": "object",
      "properties": {
        "accountName": {
          "type": "string"
        },
        "azureFileUrl": {
          "type": "string"
        },
        "credentials": {
          "oneOf": [
            {
              "$ref": "#/definitions/AzureStorageCredentialsInfo"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        },
        "relativeMountPath": {
          "type": "string",
          "description": "Note that all file shares will be mounted under $AZ_BATCHAI_MOUNT_ROOT location."
        },
        "fileMode": {
          "type": "string",
          "default": "0777",
          "description": "Default value is 0777. Valid only if OS is linux."
        },
        "directoryMode": {
          "type": "string",
          "default": "0777",
          "description": "Default value is 0777. Valid only if OS is linux."
        }
      },
      "required": [
        "accountName",
        "azureFileUrl",
        "credentials",
        "relativeMountPath"
      ],
      "description": "Details of the Azure File Share to mount on the cluster."
    },
    "AzureStorageCredentialsInfo": {
      "type": "object",
      "properties": {
        "accountKey": {
          "type": "string",
          "description": "One of accountKey or accountKeySecretReference must be specified."
        },
        "accountKeySecretReference": {
          "oneOf": [
            {
              "$ref": "#/definitions/KeyVaultSecretReference"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ],
          "description": "Users can store their secrets in Azure KeyVault and pass it to the Batch AI Service to integrate with KeyVault. One of accountKey or accountKeySecretReference must be specified."
        }
      },
      "description": "Credentials to access Azure File Share."
    },
    "Caffe2Settings": {
      "type": "object",
      "properties": {
        "pythonScriptFilePath": {
          "type": "string"
        },
        "pythonInterpreterPath": {
          "type": "string"
        },
        "commandLineArgs": {
          "type": "string"
        }
      },
      "required": [
        "pythonScriptFilePath"
      ],
      "description": "Specifies the settings for Caffe2 job."
    },
    "CaffeSettings": {
      "type": "object",
      "properties": {
        "configFilePath": {
          "type": "string",
          "description": "This property cannot be specified if pythonScriptFilePath is specified."
        },
        "pythonScriptFilePath": {
          "type": "string",
          "description": "This property cannot be specified if configFilePath is specified."
        },
        "pythonInterpreterPath": {
          "type": "string",
          "description": "This property can be specified only if the pythonScriptFilePath is specified."
        },
        "commandLineArgs": {
          "type": "string"
        },
        "processCount": {
          "type": "integer",
          "description": "The default value for this property is equal to nodeCount property"
        }
      },
      "description": "Specifies the settings for Caffe job."
    },
    "ChainerSettings": {
      "type": "object",
      "properties": {
        "pythonScriptFilePath": {
          "type": "string"
        },
        "pythonInterpreterPath": {
          "type": "string"
        },
        "commandLineArgs": {
          "type": "string"
        },
        "processCount": {
          "oneOf": [
            {
              "type": "integer"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ],
          "description": "The default value for this property is equal to nodeCount property"
        }
      },
      "required": [
        "pythonScriptFilePath"
      ],
      "description": "Specifies the settings for Chainer job."
    },
    "ClusterBaseProperties": {
      "type": "object",
      "properties": {
        "vmSize": {
          "type": "string",
          "description": "All virtual machines in a cluster are the same size. For information about available VM sizes for clusters using images from the Virtual Machines Marketplace (see Sizes for Virtual Machines (Linux) or Sizes for Virtual Machines (Windows). Batch AI service supports all Azure VM sizes except STANDARD_A0 and those with premium storage (STANDARD_GS, STANDARD_DS, and STANDARD_DSV2 series)."
        },
        "vmPriority": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "dedicated",
                "lowpriority"
              ]
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ],
          "description": "Default is dedicated."
        },
        "scaleSettings": {
          "oneOf": [
            {
              "$ref": "#/definitions/ScaleSettings"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        },
        "virtualMachineConfiguration": {
          "oneOf": [
            {
              "$ref": "#/definitions/VirtualMachineConfiguration"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        },
        "nodeSetup": {
          "oneOf": [
            {
              "$ref": "#/definitions/NodeSetup"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        },
        "userAccountSettings": {
          "oneOf": [
            {
              "$ref": "#/definitions/UserAccountSettings"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        },
        "subnet": {
          "oneOf": [
            {
              "$ref": "#/definitions/ResourceId"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        }
      },
      "required": [
        "vmSize",
        "userAccountSettings"
      ],
      "description": "The properties of a Cluster."
    },
    "CNTKsettings": {
      "type": "object",
      "properties": {
        "languageType": {
          "type": "string",
          "description": "Valid values are 'BrainScript' or 'Python'."
        },
        "configFilePath": {
          "type": "string",
          "description": "This property can be specified only if the languageType is 'BrainScript'."
        },
        "pythonScriptFilePath": {
          "type": "string",
          "description": "This property can be specified only if the languageType is 'Python'."
        },
        "pythonInterpreterPath": {
          "type": "string",
          "description": "This property can be specified only if the languageType is 'Python'."
        },
        "commandLineArgs": {
          "type": "string"
        },
        "processCount": {
          "oneOf": [
            {
              "type": "integer"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ],
          "description": "The default value for this property is equal to nodeCount property"
        }
      },
      "description": "Specifies the settings for CNTK (aka Microsoft Cognitive Toolkit) job."
    },
    "ContainerSettings": {
      "type": "object",
      "properties": {
        "imageSourceRegistry": {
          "oneOf": [
            {
              "$ref": "#/definitions/ImageSourceRegistry"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        }
      },
      "required": [
        "imageSourceRegistry"
      ],
      "description": "Settings for the container to be downloaded."
    },
    "CustomToolkitSettings": {
      "type": "object",
      "properties": {
        "commandLine": {
          "type": "string"
        }
      },
      "required": ["commandLine"],
      "description": "Specifies the settings for a custom tool kit job."
    },
    "DataDisks": {
      "type": "object",
      "properties": {
        "diskSizeInGB": {
          "oneOf": [
            {
              "type": "integer"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        },
        "diskCount": {
          "oneOf": [
            {
              "type": "integer"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        },
        "storageAccountType": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "Standard_LRS",
                "Premium_LRS"
              ]
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        }
      },
      "required": [
        "diskSizeInGB",
        "diskCount",
        "storageAccountType"
      ],
      "description": "Settings for the data disk which would be created for the File Server."
    },
    "EnvironmentSetting": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string"
        },
        "value": {
          "type": "string"
        }
      },
      "required": [
        "name"
      ],
      "description": "An environment variable to set."
    },
    "FileServerBaseProperties": {
      "type": "object",
      "properties": {
        "vmSize": {
          "type": "string",
          "description": "For information about available VM sizes for fileservers from the Virtual Machines Marketplace, see Sizes for Virtual Machines (Linux)."
        },
        "sshConfiguration": {
          "oneOf": [
            {
              "$ref": "#/definitions/SshConfiguration"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        },
        "dataDisks": {
          "oneOf": [
            {
              "$ref": "#/definitions/DataDisks"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        },
        "subnet": {
          "oneOf": [
            {
              "$ref": "#/definitions/ResourceId"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        }
      },
      "required": [
        "vmSize",
        "sshConfiguration",
        "dataDisks"
      ],
      "description": "The properties of a file server."
    },
    "FileServerReference": {
      "type": "object",
      "properties": {
        "fileServer": {
          "oneOf": [
            {
              "$ref": "#/definitions/ResourceId"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        },
        "sourceDirectory": {
          "type": "string",
          "description": "If this property is not specified, the entire File Server will be mounted."
        },
        "relativeMountPath": {
          "type": "string",
          "description": "Note that all file shares will be mounted under $AZ_BATCHAI_MOUNT_ROOT location."
        },
        "mountOptions": {
          "type": "string"
        }
      },
      "required": [
        "fileServer",
        "relativeMountPath"
      ],
      "description": "Provides required information, for the service to be able to mount Azure FileShare on the cluster nodes."
    },
    "ImageReference": {
      "type": "object",
      "properties": {
        "publisher": {
          "type": "string"
        },
        "offer": {
          "type": "string"
        },
        "sku": {
          "type": "string"
        },
        "version": {
          "type": "string"
        }
      },
      "required": [
        "publisher",
        "offer",
        "sku"
      ],
      "description": "The image reference."
    },
    "ImageSourceRegistry": {
      "type": "object",
      "properties": {
        "serverUrl": {
          "type": "string"
        },
        "image": {
          "type": "string"
        },
        "credentials": {
          "oneOf": [
            {
              "$ref": "#/definitions/PrivateRegistryCredentials"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        }
      },
      "required": [
        "image"
      ],
      "description": "Details of the container image such as name, URL and credentials."
    },
    "InputDirectory": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "It will be available for the job as an environment variable under AZ_BATCHAI_INPUT_id. The service will also provide the following  environment variable: AZ_BATCHAI_PREV_OUTPUT_Name. The value of the variable will be populated if the job is being retried after a previous failure, otherwise it will be set to nothing."
        },
        "path": {
          "type": "string"
        }
      },
      "required": [
        "id",
        "path"
      ],
      "description": "Input directory for the job."
    },
    "JobBaseProperties_constraints": {
      "type": "object",
      "properties": {
        "maxWallClockTime": {
          "type": "string",
          "default": "7.00:00:00",
          "format": "duration",
          "description": "Default Value = 1 week."
        }
      },
      "description": "Constraints associated with the Job."
    },
    "JobPreparation": {
      "type": "object",
      "properties": {
        "commandLine": {
          "type": "string",
          "description": "If containerSettings is specified on the job, this commandLine will be executed in the same container as job. Otherwise it will be executed on the node."
        }
      },
      "required": [
        "commandLine"
      ],
      "description": "Specifies the settings for job preparation."
    },
    "KeyVaultSecretReference": {
      "type": "object",
      "properties": {
        "sourceVault": {
          "oneOf": [
            {
              "$ref": "#/definitions/ResourceId"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        },
        "secretUrl": {
          "type": "string"
        }
      },
      "required": [
        "sourceVault",
        "secretUrl"
      ],
      "description": "Describes a reference to Key Vault Secret."
    },
    "ManualScaleSettings": {
      "type": "object",
      "properties": {
        "targetNodeCount": {
          "oneOf": [
            {
              "type": "integer",
              "default": "0"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ],
          "description": "Default is 0. If autoScaleSettings are not specified, then the Cluster starts with this target."
        },
        "nodeDeallocationOption": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "requeue",
                "terminate",
                "waitforjobcompletion",
                "unknown"
              ]
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ],
          "description": "The default value is requeue."
        }
      },
      "required": [
        "targetNodeCount"
      ],
      "description": "Manual scale settings for the cluster."
    },
    "MountVolumes": {
      "type": "object",
      "properties": {
        "azureFileShares": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "$ref": "#/definitions/AzureFileShareReference"
              }
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ],
          "description": "References to Azure File Shares that are to be mounted to the cluster nodes."
        },
        "azureBlobFileSystems": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "$ref": "#/definitions/AzureBlobFileSystemReference"
              }
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ],
          "description": "References to Azure Blob FUSE that are to be mounted to the cluster nodes."
        },
        "fileServers": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "$ref": "#/definitions/FileServerReference"
              }
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        },
        "unmanagedFileSystems": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "$ref": "#/definitions/UnmanagedFileSystemReference"
              }
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        }
      },
      "description": "Details of volumes to mount on the cluster."
    },
    "NodeSetup": {
      "type": "object",
      "properties": {
        "setupTask": {
          "oneOf": [
            {
              "$ref": "#/definitions/SetupTask"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        },
        "mountVolumes": {
          "oneOf": [
            {
              "$ref": "#/definitions/MountVolumes"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        }
      },
      "description": "Use this to prepare the VM. NOTE: The volumes specified in mountVolumes are mounted first and then the setupTask is run. Therefore the setup task can use local mountPaths in its execution."
    },
    "OutputDirectory": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "It will be available for the job as an environment variable under AZ_BATCHAI_OUTPUT_id."
        },
        "pathPrefix": {
          "type": "string",
          "description": "NOTE: This is an absolute path to prefix. E.g. $AZ_BATCHAI_MOUNT_ROOT/MyNFS/MyLogs."
        },
        "pathSuffix": {
          "type": "string",
          "description": "The suffix path where the output directory will be created."
        },
        "type": {
          "type": "string",
          "enum": [
            "model",
            "logs",
            "summary",
            "custom"
          ],
          "description": "Default value is Custom. The possible values are Model, Logs, Summary, and Custom. Users can use multiple enums for a single directory. Eg. outPutType='Model,Logs, Summary'."
        },
        "createNew": {
          "oneOf": [
            {
              "type": "boolean",
              "default": true
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ],
          "description": "Default is true. If false, then the directory is not created and can be any directory path that the user specifies."
        }
      },
      "required": [
        "id",
        "pathPrefix"
      ],
      "description": "Output directory for the job."
    },
    "PrivateRegistryCredentials": {
      "type": "object",
      "properties": {
        "username": {
          "type": "string"
        },
        "password": {
          "type": "string",
          "description": "One of password or passwordSecretReference must be specified."
        },
        "passwordSecretReference": {
          "oneOf": [
            {
              "$ref": "#/definitions/KeyVaultSecretReference"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ],
          "description": "Users can store their secrets in Azure KeyVault and pass it to the Batch AI Service to integrate with KeyVault. One of password or passwordSecretReference must be specified."
        }
      },
      "required": [
        "username"
      ],
      "description": "Credentials to access a container image in a private repository."
    },
    "ResourceId": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "The ID of the resource"
        }
      },
      "required": [
        "id"
      ],
      "description": "Represents a resource ID. For example, for a subnet, it is the resource URL for the subnet."
    },
    "ScaleSettings": {
      "type": "object",
      "properties": {
        "manual": {
          "oneOf": [
            {
              "$ref": "#/definitions/ManualScaleSettings"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        },
        "autoScale": {
          "oneOf": [
            {
              "$ref": "#/definitions/AutoScaleSettings"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        }
      },
      "description": "At least one of manual or autoScale settings must be specified. Only one of manual or autoScale settings can be specified. If autoScale settings are specified, the system automatically scales the cluster up and down (within the supplied limits) based on the pending jobs on the cluster."
    },
    "SetupTask": {
      "type": "object",
      "properties": {
        "commandLine": {
          "type": "string"
        },
        "environmentVariables": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "$ref": "#/definitions/EnvironmentSetting"
              }
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        },
        "runElevated": {
          "oneOf": [
            {
              "type": "boolean",
              "default": false
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        },
        "stdOutErrPathPrefix": {
          "type": "string",
          "description": "The path where the Batch AI service will upload the stdout and stderror of setup task."
        }
      },
      "required": [
        "commandLine",
        "stdOutErrPathPrefix"
      ],
      "description": "Specifies a setup task which can be used to customize the compute nodes of the cluster."
    },
    "SshConfiguration": {
      "type": "object",
      "properties": {
        "publicIPsToAllow": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ],
          "description": "Default value is '*' can be used to match all source IPs. Maximum number of publicIPs that can be specified are 400."
        },
        "userAccountSettings": {
          "oneOf": [
            {
              "$ref": "#/definitions/UserAccountSettings"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        }
      },
      "required": [
        "userAccountSettings"
      ],
      "description": "SSH configuration settings for the VM"
    },
    "TensorFlowSettings": {
      "type": "object",
      "properties": {
        "pythonScriptFilePath": {
          "type": "string"
        },
        "pythonInterpreterPath": {
          "type": "string"
        },
        "masterCommandLineArgs": {
          "type": "string"
        },
        "workerCommandLineArgs": {
          "type": "string",
          "description": "This property is optional for single machine training."
        },
        "parameterServerCommandLineArgs": {
          "type": "string",
          "description": "This property is optional for single machine training."
        },
        "workerCount": {
          "oneOf": [
            {
              "type": "integer"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ],
          "description": "If specified, the value must be less than or equal to (nodeCount * numberOfGPUs per VM). If not specified, the default value is equal to nodeCount. This property can be specified only for distributed TensorFlow training"
        },
        "parameterServerCount": {
          "oneOf": [
            {
              "type": "integer"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ],
          "description": "If specified, the value must be less than or equal to nodeCount. If not specified, the default value is equal to 1 for distributed TensorFlow training (This property is not applicable for single machine training). This property can be specified only for distributed TensorFlow training."
        }
      },
      "required": [
        "pythonScriptFilePath",
        "masterCommandLineArgs"
      ],
      "description": "Specifies the settings for TensorFlow job."
    },
    "UnmanagedFileSystemReference": {
      "type": "object",
      "properties": {
        "mountCommand": {
          "type": "string"
        },
        "relativeMountPath": {
          "type": "string",
          "description": "Note that all file shares will be mounted under $AZ_BATCHAI_MOUNT_ROOT location."
        }
      },
      "required": [
        "mountCommand",
        "relativeMountPath"
      ],
      "description": "Details of the file system to mount on the compute cluster nodes."
    },
    "UserAccountSettings": {
      "type": "object",
      "properties": {
        "adminUserName": {
          "type": "string"
        },
        "adminUserSshPublicKey": {
          "type": "string"
        },
        "adminUserPassword": {
          "type": "string"
        }
      },
      "required": [
        "adminUserName"
      ],
      "description": "Settings for user account that gets created on each on the nodes of a cluster."
    },
    "VirtualMachineConfiguration": {
      "type": "object",
      "properties": {
        "imageReference": {
          "oneOf": [
            {
              "$ref": "#/definitions/ImageReference"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
            }
          ]
        }
      },
      "description": "Settings for OS image."
    }
  }
}
